(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"./examples/example.tsx":function(e,t,n){"use strict";var r,a,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((r=r.apply(e,t||[])).next())})},l=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var d=n("./node_modules/react/index.js"),u=n("./node_modules/react-dom/index.js"),p=n("./node_modules/react-redux/es/index.js"),m=n("./node_modules/semantic-ui-react/dist/es/index.js"),g=n("./src/action/index.ts"),h=n("./src/component/index.ts"),f=n("./src/container/index.ts"),b=n("./src/data/index.ts"),C=n("./src/helper/index.ts"),E=n("./src/reducer/index.ts"),P=function(e){function t(n){var r=e.call(this,n)||this;return r.renderCouplingComponents=function(e,t){var n=(void 0===e?r.props:e).style,a=void 0===t?r.state:t,i=a.arePredictionsAvailable,o=a.couplingScores,s=a.errorMsg,l=a.isResidueMappingNeeded,c=a.measuredProximity,u=a.pdbData;return d.createElement("div",null,d.createElement(m.Header,{as:"h1",attached:"top"},"ContactMap.org: 2D and 3D Visualization"),s.length>1&&r.renderErrorMessage(),!u&&0===o.length&&r.renderStartMessage(),d.createElement(m.Segment,{attached:!0,raised:!0},d.createElement(m.Grid,{centered:!0,padded:!0,relaxed:!0},r.renderUploadButtonsRow(l),d.createElement(m.Grid.Row,null,d.createElement("br",null)),r.renderBioblocksComponents(n,i,c,u))),r.renderFooter())},r.renderErrorMessage=function(e){var t=void 0===e?r.state:e,n=t.errorMsg,a=t.isResidueMappingNeeded,i=t.mismatches,o=t.pdbData;return d.createElement(m.Message,{warning:!0},a&&o?d.createElement("div",null,d.createElement(m.Message.Header,null,"Residue numbering mismatch detected. Please upload a file to correct the position numbering differences.",d.createElement("br",null),"EVCouplings and EVFold outputs this file in the ",d.createElement("strong",null,"OUTPUT")," directory.\n                This file might be named similar to\n                '"+o.name+".csv' or '"+o.name+".indextableplus'"),d.createElement(m.Message.List,null,n),d.createElement(m.Message.Content,null,d.createElement(m.Accordion,{fluid:!0,exclusive:!1,defaultActiveIndex:[],panels:[r.renderSequenceAccordionMessage("PDB sequence",o.sequence,i,"pdb"),r.renderSequenceAccordionMessage("Couplings Score sequence",r.state[b.VIZ_TYPE.CONTACT_MAP].couplingScores.sequence,i,"coupling")]}))):n)},r.renderFooter=function(){var e=d.createElement("a",{href:"https://github.com/cBioCenter/bioblocks-viz"},"Bioblocks"),t=[d.createElement(d.Fragment,null,"Powered by ",e,"!"),d.createElement(d.Fragment,null,"They love me at the ",e,"sea."),d.createElement(d.Fragment,null,"Today's visualization has been brought to you by ",e,"."),d.createElement(d.Fragment,null,e,"sea, ",e,"sea, I believe..."),d.createElement(d.Fragment,null,"Now you're thinking with ",e,"!"),d.createElement(d.Fragment,null,"And ",e,"sea says she's got nowhere to go...")].map(function(e){return d.createElement(d.Fragment,{key:"random-bioblocks-saying"},e)}),n=t[Math.floor(Math.random()*t.length)];return d.createElement("footer",{style:{padding:"25vh 0 25px 25px"}},n)},r.renderSequenceAccordionMessage=function(e,t,n,r){var a,i,o=0,s=n[0].resno,l=new Array;try{for(var u=c(n),p=u.next();!p.done;p=u.next()){var m=p.value,g="pdb"===r?m.pdbAminoAcid:m.couplingAminoAcid,h=t.indexOf(g.singleLetterCode,o+(m.resno-s));h>=0&&(l.push(d.createElement(d.Fragment,{key:"mismatch-"+m.resno},d.createElement("span",{style:{color:"black",fontSize:"12px"}},t.substring(o,h)),d.createElement("span",{style:{color:"red",fontSize:"16px",textDecoration:"underline"}},t.charAt(h)))),s=m.resno+1,o=h+1)}}catch(e){a={error:e}}finally{try{p&&!p.done&&(i=u.return)&&i.call(u)}finally{if(a)throw a.error}}return l.push(d.createElement("span",{key:"mismatch-final",style:{color:"black",fontSize:"12px"}},t.substring(o))),{content:{content:d.createElement("p",{style:{width:"80%",wordBreak:"break-word"}},l)},key:"panel-"+e,title:{content:e+" ("+t.length+" Amino Acids)"}}},r.renderStartMessage=function(){return d.createElement(m.Message,null,"To get started, please upload either a PDB (.pdb) or EVCouplings score (.csv) file!"," ",d.createElement("br",null)," Check out the",d.createElement("a",{href:"http://evfold.org"}," EVFold"),", ",d.createElement("a",{href:"http://sanderlab.org/contact-maps/"},"Sander Lab"),", or",d.createElement("a",{href:"https://evcouplings.org/"}," EVCouplings ")," website to get these files.")},r.renderUploadForm=function(e,t,n,r,a){return void 0===a&&(a=[]),d.createElement(m.GridColumn,null,d.createElement(m.Label,{as:"label",basic:!0,htmlFor:t},d.createElement(m.Button,{disabled:r,icon:"upload",label:{basic:!0,content:n},labelPosition:"right"}),d.createElement("input",{accept:"."+a.join(",."),disabled:r,id:t,onChange:e,hidden:!0,type:"file",required:!0,multiple:!1})))},r.renderUploadLabel=function(e){return e?d.createElement(m.GridColumn,{verticalAlign:"middle",textAlign:"justified"},d.createElement(m.Label,null,e)):null},r.renderCouplingScoresUploadForm=function(e){var t=void 0===e?r.state:e,n=t.couplingScores,a=t.filenames;return d.createElement(m.GridRow,null,r.renderUploadLabel(a.couplings),r.renderUploadForm(r.onCouplingScoreUpload,"coupling-score","Coupling Scores",n.length>0,["csv"]))},r.renderBioblocksComponents=function(e,t,n,a,i){return void 0===i&&(i="550px"),d.createElement(m.GridRow,{columns:2},d.createElement(m.GridColumn,{width:7},r.renderContactMapCard(t,i,e,a)),d.createElement(m.GridColumn,{width:7},r.renderNGLCard(n,a)))},r.renderContactMapCard=function(e,t,n,a){return e?d.createElement(h.PredictedContactMap,{data:{couplingScores:r.state[b.VIZ_TYPE.CONTACT_MAP].couplingScores,pdbData:{known:a},secondaryStructures:r.state[b.VIZ_TYPE.CONTACT_MAP].secondaryStructures},height:t,isDataLoading:r.state[b.VIZ_TYPE.CONTACT_MAP].isLoading,style:n,width:t}):d.createElement(h.ContactMap,{data:{couplingScores:r.state[b.VIZ_TYPE.CONTACT_MAP].couplingScores,pdbData:{known:a},secondaryStructures:r.state[b.VIZ_TYPE.CONTACT_MAP].secondaryStructures},height:t,isDataLoading:r.state[b.VIZ_TYPE.CONTACT_MAP].isLoading,style:n,width:t})},r.renderNGLCard=function(e,t){return d.createElement(f.NGLContainer,{data:t,isDataLoading:r.state[b.VIZ_TYPE.NGL].isLoading,measuredProximity:e,onMeasuredProximityChange:r.onMeasuredProximityChange()})},r.renderUploadButtonsRow=function(e){return d.createElement(m.GridRow,{columns:4,textAlign:"center",verticalAlign:"bottom"},d.createElement(m.GridColumn,null,r.renderCouplingScoresUploadForm()),d.createElement(m.GridColumn,null,r.renderPDBUploadForm()),e&&d.createElement(m.GridColumn,null,r.renderResidueMappingUploadForm()),d.createElement(m.GridColumn,null,r.renderClearAllButton()))},r.renderPDBUploadForm=function(e){var t=void 0===e?r.state:e,n=t.filenames,a=t.pdbData;return d.createElement(m.GridRow,null,r.renderUploadLabel(n.pdb),r.renderUploadForm(r.onPDBUpload,"pdb","PDB",void 0!==a,["pdb"]))},r.renderResidueMappingUploadForm=function(e){var t=(void 0===e?r.state:e).filenames;return d.createElement(m.GridRow,{verticalAlign:"middle",columns:1,centered:!0},r.renderUploadLabel(t.residue_mapper),r.renderUploadForm(r.onResidueMappingUpload,"residue-mapping","Residue Mapping",!1,["csv","indextable","indextableplus"]))},r.renderClearAllButton=function(){return d.createElement(m.GridRow,{verticalAlign:"middle",columns:1,centered:!0},d.createElement(m.GridColumn,null,d.createElement(m.Label,{as:"label",basic:!0,htmlFor:"clear-data"},d.createElement(m.Button,{icon:"trash",label:{basic:!0,content:"Clean View"},labelPosition:"right",onClick:r.onClearAll()}))))},r.onClearAll=function(){return function(){return s(r,void 0,void 0,function(){var e,n,r;return l(this,function(a){return e=this.props,n=e.clearAllResidues,r=e.clearAllSecondaryStructures,this.setState(t.initialState),n(),r(),this.forceUpdate(),[2]})})}},r.onCouplingScoreUpload=function(e){return s(r,void 0,void 0,function(){var t,n,r,a,i,s,c,d,u,p,m,g;return l(this,function(l){switch(l.label){case 0:if(e.persist(),r=this.state,a=r.measuredProximity,i=r.pdbData,s=e.target.files,null===(c=s?s.item(0):null))return[3,6];if(!c.name.endsWith(".csv"))return[3,5];l.label=1;case 1:return l.trys.push([1,3,,4]),this.setState(((t={})[b.VIZ_TYPE.CONTACT_MAP]=o({},this.state[b.VIZ_TYPE.CONTACT_MAP],{isLoading:!0}),t)),[4,C.readFileAsText(c)];case 2:return d=l.sent(),u=C.getCouplingScoresData(d,this.state.residueMapping),p=i?i.getResidueNumberingMismatches(u):[],m=p.length>0,this.setState(((n={})[b.VIZ_TYPE.CONTACT_MAP]={couplingScores:i?i.amendPDBWithCouplingScores(u.rankedContacts,a):u,isLoading:!1,pdbData:{known:this.state.pdbData},secondaryStructures:[]},n.arePredictionsAvailable=!0,n.couplingScores=d,n.errorMsg="",n.filenames=o({},this.state.filenames,{couplings:c.name}),n.isResidueMappingNeeded=m,n)),[3,4];case 3:return g=l.sent(),console.log(g),[3,4];case 4:return[3,6];case 5:this.setState({errorMsg:"Unable to load Coupling Score file '"+c.name+"' - Make sure the file ends in '.csv'!"}),l.label=6;case 6:return e.target.value="",[2]}})})},r.onPDBUpload=function(e){return s(r,void 0,void 0,function(){var t,n,r,a,i,s,c;return l(this,function(l){switch(l.label){case 0:return e.persist(),r=this.state.measuredProximity,a=e.target.files,null===(i=a?a.item(0):null)?[3,3]:i.name.endsWith(".pdb")?(this.setState(((t={})[b.VIZ_TYPE.CONTACT_MAP]=o({},this.state[b.VIZ_TYPE.CONTACT_MAP],{isLoading:!0}),t[b.VIZ_TYPE.NGL]=o({},this.state[b.VIZ_TYPE.NGL],{isLoading:!0}),t)),[4,b.BioblocksPDB.createPDB(i)]):[3,2];case 1:return s=l.sent(),c=s.amendPDBWithCouplingScores(this.state[b.VIZ_TYPE.CONTACT_MAP].couplingScores.rankedContacts,r),this.setState(((n={})[b.VIZ_TYPE.CONTACT_MAP]={couplingScores:c,isLoading:!1,pdbData:{known:s},secondaryStructures:s.secondaryStructureSections},n[b.VIZ_TYPE.NGL]={isLoading:!1,pdbData:s.nglStructure},n.errorMsg="",n.filenames=o({},this.state.filenames,{pdb:i.name}),n.pdbData=s,n)),[3,3];case 2:this.setState({errorMsg:"Unable to load PDB file '"+i.name+"' - Make sure the file ends in '.pdb'!"}),l.label=3;case 3:return e.target.value="",[2]}})})},r.onMeasuredProximityChange=function(){return function(e){r.setState({measuredProximity:Object.values(b.CONTACT_DISTANCE_PROXIMITY)[e]})}},r.onResidueMappingUpload=function(e){return s(r,void 0,void 0,function(){var t,n,r,a,i,s,c,d,u,p,m,g;return l(this,function(l){switch(l.label){case 0:if(e.persist(),r=this.state,a=r.measuredProximity,i=r.pdbData,s=e.target.files,c=s?s.item(0):null,d=["csv","indextable","indextableplus"],null===c)return[3,6];if(!d.reduce(function(e,t){return e||c.name.endsWith("."+t)},!1))return[3,5];l.label=1;case 1:return l.trys.push([1,3,,4]),this.setState(((t={})[b.VIZ_TYPE.CONTACT_MAP]=o({},this.state[b.VIZ_TYPE.CONTACT_MAP],{isLoading:!0}),t)),[4,C.readFileAsText(c)];case 2:return u=l.sent(),p=C.generateResidueMapping(u),m=C.getCouplingScoresData(this.state.couplingScores,p),this.setState(((n={})[b.VIZ_TYPE.CONTACT_MAP]={couplingScores:i?i.amendPDBWithCouplingScores(m.rankedContacts,a):m,isLoading:!1,secondaryStructures:[]},n.errorMsg="",n.filenames=o({},this.state.filenames,{residue_mapper:c.name}),n.residueMapping=p,n)),[3,4];case 3:return g=l.sent(),console.log(g),[3,4];case 4:return[3,6];case 5:this.setState({errorMsg:"Unable to load Residue Mapping file '"+c.name+"' - Make sure the file ends in one of the following: '"+d.join("', '")+"'"}),l.label=6;case 6:return e.target.value="",[2]}})})},r.state=t.initialState,r}return i(t,e),t.prototype.componentDidUpdate=function(e,t){var n,r=this.state,a=r.measuredProximity,i=r.pdbData,o=this.state[b.VIZ_TYPE.CONTACT_MAP].couplingScores,s="",l=this.state.mismatches,c=this.state.isResidueMappingNeeded;!i||o===t[b.VIZ_TYPE.CONTACT_MAP].couplingScores&&i===t.pdbData||(l=b.getPDBAndCouplingMismatch(i,o)).length>=1&&(s="Error details: "+l.length+" mismatch(es) detected between coupling scores and PDB!        For example, residue number "+l[0].resno+" is '"+l[0].pdbAminoAcid.threeLetterCode+"' in the PDB but '"+l[0].couplingAminoAcid.threeLetterCode+"' in the coupling scores file.",c=!0),i&&a!==t.measuredProximity?this.setState(((n={})[b.VIZ_TYPE.CONTACT_MAP]={couplingScores:i.amendPDBWithCouplingScores(o.rankedContacts,a),isLoading:!1,pdbData:{known:this.state.pdbData},secondaryStructures:[]},n.errorMsg=s,n.isResidueMappingNeeded=c,n.mismatches=l,n)):s.length>=1&&this.setState({errorMsg:s,isResidueMappingNeeded:c,mismatches:l})},t.prototype.render=function(e){var t=(void 0===e?this.props:e).style;return d.createElement("div",{id:"BioblocksVizApp",style:o({},t,{height:"1000px"})},this.renderCouplingComponents(),d.createElement(f.ProteinFeatureViewer,null))},t.defaultProps={style:{backgroundColor:"#ffffff"}},t.initialState=((a={})[b.VIZ_TYPE.CONTACT_MAP]={couplingScores:new b.CouplingContainer,isLoading:!1,pdbData:void 0,secondaryStructures:[]},a[b.VIZ_TYPE.NGL]={isLoading:!1,pdbData:void 0},a.arePredictionsAvailable=!1,a.couplingScores="",a.errorMsg="",a.filenames={},a.isResidueMappingNeeded=!1,a.measuredProximity=b.CONTACT_DISTANCE_PROXIMITY.CLOSEST,a.mismatches=[],a.pdbData=void 0,a.residueMapping=[],a),t}(d.Component),A=p.connect(function(e){return{clearAllResidues:function(){g.createResiduePairActions().candidates.clear(),g.createResiduePairActions().hovered.clear(),g.createResiduePairActions().locked.clear()},clearAllSecondaryStructures:function(){g.createContainerActions("secondaryStructure/hovered").clear(),g.createContainerActions("secondaryStructure/selected").clear()}}})(P);u.render(d.createElement(p.Provider,{store:E.Store},d.createElement(A,null)),document.getElementById("example-root"))}},[["./examples/example.tsx",7,1,0]]]);